<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>MOOD.OS</title>

    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Space+Grotesk:wght@600;700&display=swap"
        rel="stylesheet">

    <style>
        /* ================= RESET ================= */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #0a0a0a, #1a1a2e);
            color: #fff;
            font-family: Inter, sans-serif;
            min-height: 100vh;
        }

        /* ================= LAYOUT ================= */
        .container {
            max-width: 1200px;
            margin: auto;
            padding: 1.25rem;
        }

        /* ================= HEADER ================= */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-family: Space Grotesk;
            font-size: 1.6rem;
        }

        .logo span {
            background: linear-gradient(135deg, #00ff88, #00ccff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .status {
            font-size: .8rem;
            color: #aaa;
        }

        /* ================= GRID (MOBILE FIRST) ================= */
        .grid {
            display: flex;
            flex-direction: column;
            gap: 1.25rem;
            margin-top: 1.5rem;
        }

        /* ================= CARDS ================= */
        .card,
        .result-area {
            background: rgba(255, 255, 255, .03);
            border: 1px solid rgba(255, 255, 255, .1);
            border-radius: 20px;
            padding: 1.5rem;
        }

        /* ================= UPLOAD ================= */
        .upload-zone {
            border: 2px dashed rgba(255, 255, 255, .25);
            border-radius: 14px;
            padding: 2.5rem 1.5rem;
            text-align: center;
            cursor: pointer;
        }

        .upload-zone:hover {
            border-color: #00ff88;
        }

        /* ================= BUTTONS ================= */
        .btn {
            width: 100%;
            padding: 1rem;
            margin-top: .75rem;
            border-radius: 12px;
            border: none;
            font-weight: 600;
            font-size: .95rem;
            cursor: pointer;
        }

        .primary {
            background: linear-gradient(135deg, #00ff88, #00ccff);
            color: #000;
        }

        .secondary {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, .25);
            color: #fff;
        }

        /* ================= CAMERA ================= */
        .video-box video {
            width: 100%;
            border-radius: 14px;
            transform: scaleX(-1);
        }

        /* ================= RESULT ================= */
        .result-area {
            min-height: 360px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #result img {
            width: 100%;
            border-radius: 14px;
            margin-bottom: 1rem;
        }

        /* ================= SONGS ================= */
        .song-list {
            margin-top: 1.25rem;
            padding-top: .75rem;
            border-top: 1px solid rgba(255, 255, 255, .1);
        }

        .song-item {
            margin-top: .5rem;
            font-size: .95rem;
        }

        .song-item a {
            color: #00ff88;
            text-decoration: none;
        }

        .song-item a:hover {
            text-decoration: underline;
        }

        /* ================= UTIL ================= */
        .hidden {
            display: none;
        }

        /* ================= LOADER ================= */
        .loader {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, .9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 999;
            font-weight: 600;
        }

        .loader.active {
            display: flex;
        }

        /* ================= BREAKPOINTS ================= */

        /* Tablets */
        @media (min-width: 768px) {
            .container {
                padding: 2rem;
            }

            .logo {
                font-size: 1.8rem;
            }

            .result-area {
                min-height: 420px;
            }
        }

        /* Desktop */
        @media (min-width: 1024px) {
            .grid {
                display: grid;
                grid-template-columns: 420px 1fr;
                gap: 2rem;
            }

            .card,
            .result-area {
                padding: 2rem;
                border-radius: 24px;
            }

            .logo {
                font-size: 2rem;
            }
        }
    </style>
</head>

<body>

    <div class="loader" id="loader">Reading your expressionâ€¦</div>

    <div class="container">
        <header>
            <div class="logo">MOOD<span>.OS</span></div>
            <div class="status" id="status">Ready</div>
        </header>

        <div class="grid">

            <!-- INPUT -->
            <div class="card">
                <div class="upload-zone" id="uploadZone">
                    <strong>Upload a photo</strong><br>
                    Clear face Â· Good lighting
                    <input type="file" id="fileInput" hidden>
                </div>

                <div id="cameraContainer" class="hidden">
                    <div class="video-box">
                        <video id="webcamVideo" autoplay playsinline></video>
                    </div>
                    <button class="btn primary" id="captureBtn">Capture Photo</button>
                </div>

                <button class="btn primary" id="startCam">Start Camera</button>
                <button class="btn secondary" id="reset">Start over</button>
            </div>

            <!-- RESULT -->
            <div class="result-area">
                <div id="placeholder">
                    Curious how youâ€™re feeling right now?
                </div>

                <div id="result" class="hidden">
                    <img id="resultImage">
                    <h2 id="emotion"></h2>
                    <p id="description" style="color:#ccc;margin-top:.25rem"></p>
                    <small id="confidence"></small>
                    <div id="songs" class="song-list"></div>
                </div>
            </div>

        </div>
    </div>

    <script>
        const API = location.origin;
        let webcamStream = null;

        const loader = document.getElementById("loader");
        const status = document.getElementById("status");
        const uploadZone = document.getElementById("uploadZone");
        const fileInput = document.getElementById("fileInput");
        const cameraContainer = document.getElementById("cameraContainer");
        const webcamVideo = document.getElementById("webcamVideo");
        const captureBtn = document.getElementById("captureBtn");
        const startCamBtn = document.getElementById("startCam");
        const placeholder = document.getElementById("placeholder");
        const result = document.getElementById("result");
        const resultImage = document.getElementById("resultImage");
        const emotion = document.getElementById("emotion");
        const description = document.getElementById("description");
        const confidence = document.getElementById("confidence");
        const songsBox = document.getElementById("songs");

        function setLoading(v) {
            loader.classList.toggle("active", v);
            status.textContent = v ? "Processingâ€¦" : "Ready";
        }

        uploadZone.onclick = () => fileInput.click();

        fileInput.onchange = async () => {
            if (!fileInput.files[0]) return;
            setLoading(true);
            placeholder.style.display = "none";
            const fd = new FormData();
            fd.append("file", fileInput.files[0]);
            const res = await fetch(API + "/upload", { method: "POST", body: fd });
            const data = await res.json();
            setLoading(false);
            showResult(data);
        };

        startCamBtn.onclick = async () => {
            if (webcamStream) { stopCamera(); return; }
            try {
                webcamStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" }, audio: false });
                webcamVideo.srcObject = webcamStream;
                uploadZone.classList.add("hidden");
                cameraContainer.classList.remove("hidden");
                startCamBtn.textContent = "Stop Camera";
                startCamBtn.classList.replace("primary", "secondary");
            } catch { alert("Camera access denied"); }
        };

        captureBtn.onclick = async () => {
            const canvas = document.createElement("canvas");
            canvas.width = webcamVideo.videoWidth;
            canvas.height = webcamVideo.videoHeight;
            const ctx = canvas.getContext("2d");
            ctx.scale(-1, 1);
            ctx.drawImage(webcamVideo, -canvas.width, 0, canvas.width, canvas.height);
            setLoading(true);
            const res = await fetch(API + "/webcam", { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ image: canvas.toDataURL("image/jpeg", 0.95) }) });
            const data = await res.json();
            setLoading(false);
            stopCamera();
            showResult(data);
        };

        function stopCamera() {
            if (webcamStream) { webcamStream.getTracks().forEach(t => t.stop()); webcamStream = null; }
            webcamVideo.srcObject = null;
            cameraContainer.classList.add("hidden");
            uploadZone.classList.remove("hidden");
            startCamBtn.textContent = "Start Camera";
            startCamBtn.classList.replace("secondary", "primary");
        }

        function ytLink(t, a) {
            return `https://www.youtube.com/results?search_query=${encodeURIComponent(t + " " + a + " official audio")}`;
        }

        function showResult(data) {
            result.classList.remove("hidden");
            resultImage.src = data.image;
            emotion.textContent = data.insight.emotion;
            description.textContent = data.insight.description;
            confidence.textContent = "Confidence: " + data.insight.confidence;
            songsBox.innerHTML = "";
            if (data.songs) {
                data.songs.forEach(s => {
                    const d = document.createElement("div");
                    d.className = "song-item";
                    d.innerHTML = `ðŸŽµ <a href="${ytLink(s.title, s.artist)}" target="_blank">${s.title} â€” ${s.artist}</a>`;
                    songsBox.appendChild(d);
                });
            }
        }

        document.getElementById("reset").onclick = () => location.reload();
    </script>

</body>

</html>